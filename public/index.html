<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #1e3c72;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            background: #1e3c72;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }

        button:hover {
            background: #2a5298;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-add {
            background: #27ae60;
        }

        .btn-add:hover {
            background: #229954;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-header h2 {
            color: #1e3c72;
        }

        .close-btn {
            background: #e74c3c;
            padding: 8px 15px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #1e3c72;
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 1px;
        }

        td {
            padding: 15px;
            text-align: left;
        }

        tbody tr {
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            padding: 6px 12px;
            margin-right: 5px;
            font-size: 14px;
        }

        .btn-edit {
            background: #3498db;
        }

        .btn-edit:hover {
            background: #2980b9;
        }

        .btn-delete {
            background: #e74c3c;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .badge-engineering { background: #e3f2fd; color: #1976d2; }
        .badge-marketing { background: #f3e5f5; color: #7b1fa2; }
        .badge-sales { background: #e8f5e9; color: #388e3c; }
        .badge-hr { background: #fff3e0; color: #f57c00; }
        .badge-finance { background: #fce4ec; color: #c2185b; }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
            }

            .search-box {
                width: 100%;
            }

            .table-container {
                overflow-x: auto;
            }

            table {
                min-width: 900px;
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üë• Employee Management System</h1>
            <p>Full-Stack CRUD Application with SQL Database</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Employees</h3>
                <div class="number" id="totalEmployees">0</div>
            </div>
            <div class="stat-card">
                <h3>Average Salary</h3>
                <div class="number" id="avgSalary">$0</div>
            </div>
            <div class="stat-card">
                <h3>Departments</h3>
                <div class="number" id="deptCount">0</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-add" onclick="openModal()">‚ûï Add Employee</button>
            <input type="text" class="search-box" id="searchBox" placeholder="üîç Search employees by name, email, or position...">
            <select id="deptFilter" onchange="filterEmployees()">
                <option value="">All Departments</option>
                <option value="Engineering">Engineering</option>
                <option value="Marketing">Marketing</option>
                <option value="Sales">Sales</option>
                <option value="HR">HR</option>
                <option value="Finance">Finance</option>
            </select>
            <button onclick="loadEmployees()">üîÑ Refresh</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Department</th>
                        <th>Position</th>
                        <th>Salary</th>
                        <th>Hire Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeeTable">
                    <tr>
                        <td colspan="8" class="loading">‚è≥ Loading employees...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal for Add/Edit Employee -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Employee</h2>
                <button class="close-btn" onclick="closeModal()">‚úï</button>
            </div>
            <form id="employeeForm">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="empName" required placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="empEmail" required placeholder="employee@company.com">
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="empPhone" placeholder="+1 (555) 123-4567">
                </div>
                <div class="form-group">
                    <label>Department *</label>
                    <select id="empDept" required>
                        <option value="">Select Department</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Sales">Sales</option>
                        <option value="HR">HR</option>
                        <option value="Finance">Finance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Position *</label>
                    <input type="text" id="empPosition" required placeholder="e.g., Senior Developer">
                </div>
                <div class="form-group">
                    <label>Salary (Annual) *</label>
                    <input type="number" id="empSalary" required min="0" step="1000" placeholder="50000">
                </div>
                <div class="form-group">
                    <label>Hire Date *</label>
                    <input type="date" id="empHireDate" required>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-add">üíæ Save Employee</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let allEmployees = [];
        let editingId = null;

        // Load employees on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadEmployees();
            
            // Set max date to today for hire date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('empHireDate').setAttribute('max', today);
        });

        // Load all employees from API
        async function loadEmployees() {
            try {
                const response = await fetch(`${API_URL}/employees`);
                const data = await response.json();
                allEmployees = data.employees || [];
                displayEmployees(allEmployees);
                loadStats();
            } catch (error) {
                console.error('Error loading employees:', error);
                document.getElementById('employeeTable').innerHTML = `
                    <tr><td colspan="8" class="empty-state">
                        <h3>‚ö†Ô∏è Error loading employees</h3>
                        <p>Make sure the server is running on port 3000!</p>
                        <p style="color: #e74c3c; font-size: 0.9em; margin-top: 10px;">Run: npm start</p>
                    </td></tr>
                `;
            }
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/stats`);
                const data = await response.json();
                document.getElementById('totalEmployees').textContent = data.totalEmployees || 0;
                document.getElementById('avgSalary').textContent = `$${Math.round(data.averageSalary || 0).toLocaleString()}`;
                document.getElementById('deptCount').textContent = data.byDepartment ? data.byDepartment.length : 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Display employees in table
        function displayEmployees(employees) {
            const tbody = document.getElementById('employeeTable');
            
            if (!employees || employees.length === 0) {
                tbody.innerHTML = `
                    <tr><td colspan="8" class="empty-state">
                        <h3>üì≠ No employees found</h3>
                        <p>Click "Add Employee" button to add your first employee!</p>
                    </td></tr>
                `;
                return;
            }

            tbody.innerHTML = employees.map(emp => {
                const deptClass = emp.department.toLowerCase().replace(/\s+/g, '-');
                return `
                    <tr>
                        <td><strong>#${emp.id}</strong></td>
                        <td>${emp.name}</td>
                        <td>${emp.email}</td>
                        <td><span class="badge badge-${deptClass}">${emp.department}</span></td>
                        <td>${emp.position}</td>
                        <td><strong>$${Number(emp.salary).toLocaleString()}</strong></td>
                        <td>${new Date(emp.hire_date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</td>
                        <td>
                            <button class="action-btn btn-edit" onclick="editEmployee(${emp.id})">‚úèÔ∏è Edit</button>
                            <button class="action-btn btn-delete" onclick="deleteEmployee(${emp.id})">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Open modal for add/edit
        function openModal(id = null) {
            editingId = id;
            const modal = document.getElementById('employeeModal');
            const form = document.getElementById('employeeForm');
            
            if (id) {
                document.getElementById('modalTitle').textContent = '‚úèÔ∏è Edit Employee';
                const emp = allEmployees.find(e => e.id === id);
                if (emp) {
                    document.getElementById('empName').value = emp.name;
                    document.getElementById('empEmail').value = emp.email;
                    document.getElementById('empPhone').value = emp.phone || '';
                    document.getElementById('empDept').value = emp.department;
                    document.getElementById('empPosition').value = emp.position;
                    document.getElementById('empSalary').value = emp.salary;
                    document.getElementById('empHireDate').value = emp.hire_date;
                }
            } else {
                document.getElementById('modalTitle').textContent = '‚ûï Add New Employee';
                form.reset();
            }
            
            modal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('employeeModal').classList.remove('active');
            document.getElementById('employeeForm').reset();
            editingId = null;
        }

        // Save employee (create or update)
        async function saveEmployee(e) {
            e.preventDefault();
            
            const employee = {
                name: document.getElementById('empName').value.trim(),
                email: document.getElementById('empEmail').value.trim(),
                phone: document.getElementById('empPhone').value.trim(),
                department: document.getElementById('empDept').value,
                position: document.getElementById('empPosition').value.trim(),
                salary: parseFloat(document.getElementById('empSalary').value),
                hire_date: document.getElementById('empHireDate').value
            };

            try {
                const url = editingId ? `${API_URL}/employees/${editingId}` : `${API_URL}/employees`;
                const method = editingId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(employee)
                });

                const result = await response.json();

                if (response.ok) {
                    closeModal();
                    loadEmployees();
                    alert(`‚úÖ Employee ${editingId ? 'updated' : 'added'} successfully!`);
                } else {
                    alert('‚ùå Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error saving employee:', error);
                alert('‚ùå Error saving employee. Please check if server is running!');
            }
        }

        // Edit employee
        function editEmployee(id) {
            openModal(id);
        }

        // Delete employee
        async function deleteEmployee(id) {
            const employee = allEmployees.find(e => e.id === id);
            if (!confirm(`Are you sure you want to delete ${employee.name}?`)) return;

            try {
                const response = await fetch(`${API_URL}/employees/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadEmployees();
                    alert('‚úÖ Employee deleted successfully!');
                } else {
                    alert('‚ùå Error deleting employee!');
                }
            } catch (error) {
                console.error('Error deleting employee:', error);
                alert('‚ùå Error deleting employee!');
            }
        }

        // Filter employees
        function filterEmployees() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            const dept = document.getElementById('deptFilter').value;
            
            let filtered = allEmployees;
            
            if (search) {
                filtered = filtered.filter(emp => 
                    emp.name.toLowerCase().includes(search) ||
                    emp.email.toLowerCase().includes(search) ||
                    emp.position.toLowerCase().includes(search)
                );
            }
            
            if (dept) {
                filtered = filtered.filter(emp => emp.department === dept);
            }
            
            displayEmployees(filtered);
        }

        // Event listeners
        document.getElementById('searchBox').addEventListener('input', filterEmployees);
        document.getElementById('employeeForm').addEventListener('submit', saveEmployee);

        // Close modal when clicking outside
        document.getElementById('employeeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>